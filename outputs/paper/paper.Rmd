---
title: "TBD"
subtitle: "TBD"
author: "Yingying Zhou, Yang Wu, Xinyi Xu, Hong Pan"
thanks: "Code and data are available at: https://github.com/yangg1224/Political_Deepfake_Videos.git."
date: "`r format(Sys.time(), '%d %B %Y')`"
abstract: "First sentence. Second sentence. Third sentence. Fourth sentence."
output:
  bookdown::pdf_document2:
  toc: FALSE
bibliography: references.bib
editor_options: 
  chunk_output_type: inline
---

```{r setup, include=FALSE,echo=FALSE, warning=FALSE, message=FALSE}
knitr::opts_chunk$set(echo = TRUE)

library(tidyverse)
library(palmerpenguins)
library(ggplot2)
library(ggthemes)
library(ggpubr)
library(hrbrthemes)
library(kableExtra)
library(broom)

```

# Introduction




# Data


```{r loaddata, echo=FALSE, warning=FALSE, message=FALSE}
library(here) # locate the file path

data<- load(here::here("inputs/data/deepfake.RData"))

EDA<- dat%>%
        select(treat, response_wave_ID, exp_1_prompt, meta_OS, age_65, educ, PID, crt, gender, age, polknow, internet_usage, ambivalent_sexism, post_favor_Sanders,believed_true)


```


## EDA

### treat distribution 
```{r treat, fig.cap = "Employee numbers distribution",echo=FALSE, fig.width=10, fig.height=4}



EDA<-EDA%>%
  drop_na(treat)

treat_map <- 
  EDA%>%
  ggplot(aes(x = treat, fill = treat)) +
  geom_bar(width = 0.7,position = "dodge") + 
  coord_polar()+
  scale_fill_manual(values = c("#DB7558", "#FFCF57","#8FCDD4","#F6A6B6", "#ACD8CB","#3E737D"))+
  labs(title = "Treat distribution",x="", y="Count") +
  theme_minimal()

treat_map

```


### education level distribution by PID 
```{r educationPID, fig.cap = "Educational level by PID",echo=FALSE, fig.width=10, fig.height=7}
edu <- 
  EDA%>%
  ggplot(aes(x = educ,fill=PID, )) +
  geom_bar(position="dodge") +
  labs(title = "Citizens with a high school degree or above are more likely to suppprt democratic and republican party",x= "Educational Level", y="Count")+
  scale_fill_manual(name = "Political Parties",values = c("#DB7558", "#FFCF57","#8FCDD4"))

edu
```






### sexism by education level 
```{r sexism, fig.cap = "sexism by education level",echo=FALSE, fig.width=5, fig.height=4}
EDA<-EDA%>%
  drop_na(ambivalent_sexism)

s1<-
  ggplot(EDA, aes(x = PID, y= ambivalent_sexism)) +
  geom_boxplot(outlier.colour="red", 
               outlier.shape=5,
               outlier.size=4) +
  labs(title="Sexism by education level", x="PID", y="Sexism")+
  theme_economist() + scale_fill_economist() 
s1
```



## internet usage frequency by education level
```{r internet, fig.cap = "internet usages",echo=FALSE, fig.width=15, fig.height=5}

G1<-ggplot(EDA, aes(x=internet_usage, fill=EDA$educ)) + 
    geom_area(alpha=0.8 , size=0.2, colour="black", stat = "count")+
    labs(title = "Internet usage frequency by education level ",y="Counts",x="Days")+
    scale_fill_manual(name = "Education level", values = c("#DB7558", "#FFCF57","#8FCDD4","#F6A6B6"))

G2<-ggplot(EDA, aes(x=internet_usage, fill=EDA$meta_OS)) + 
    geom_area(alpha=0.8 , size=0.2, colour="black", stat = "count")+
    labs(title = "Internet usage frequency by devices ",y="Counts",x="Days")+
    scale_fill_manual(name = "Devices", values = c("#DB7558", "#FFCF57","#8FCDD4","#F6A6B6"))


G3<-ggplot(EDA, aes(x=internet_usage, fill=EDA$age_65)) + 
    geom_area(alpha=0.8 , size=0.2, colour="black", stat = "count")+
    labs(title = "Internet usage frequency by age group ",y="Counts",x="Days")+
    scale_fill_manual(name = "Age group", values = c("#DB7558", "#FFCF57","#8FCDD4","#F6A6B6"))


# combine two diagram in one graph
ggarrange(
  G1, G2, G3, 
  ncol = 3, nrow = 1,
  hjust = -0.5,
  align = "hv"
  )
```



### post favor by treat
```{r postfavor, fig.cap="Distribution of feelings towards Sanders in six different situations",echo=FALSE}
#histogram for each treat
EDA<-EDA%>%
  drop_na(post_favor_Sanders)

ggplot(EDA, aes(x = post_favor_Sanders,fill=treat)) +
  geom_histogram(bins=15,color="white") +
  facet_grid(treat ~ .)+
  scale_fill_manual(values = c("#DB7558", "#FFCF57","#8FCDD4","#F6A6B6", "#ACD8CB","#3E737D"))+
  xlab("Feelings towards Sanders")+
  ggtitle("Distribution of feelings towards Sanders in six different conditions")+
  theme_minimal()


```

### Average deception level by treat
```{r table1,tab.cap="Average deception level of each media format", echo = FALSE,warning=FALSE}
EDA%>%
  group_by(treat)%>%
  filter(treat != "control")%>%
  summarise("Average Deception Level"=mean(believed_true,na.rm = T))%>%
  knitr::kable(caption = "Average deception level of each media format")
```


  


# Model

## Deception Level
### T test1

```{r ttest1, echo=FALSE, fig.width=10, fig.height=3}


t1<-t.test(na.omit(dat$believed_true[dat$treat_fake_video == 1]), 
       na.omit(dat$believed_true[dat$treat_fake_audio == 1]))

m1<-tidy(t1, digits=1)
m1 %>%
  select(-c(estimate,statistic,parameter))%>%
  rename(
    AVG_deception_video=estimate1,
    AVG_deception_audio=estimate2
  )%>%
  kableExtra::kbl(caption="T test: Deception level of video vs audio")%>%
  kableExtra::kable_styling(latex_options = "scale_down")%>% # use scale_down option to make the font
  kableExtra::kable_styling(latex_options = c("hold_position"))
```


### T test2
```{r ttest2, echo=FALSE, fig.width=10, fig.height=3}


t2<-t.test(na.omit(dat$believed_true[dat$treat_fake_video == 1]), 
       na.omit(dat$believed_true[dat$treat_fake_text == 1]))

m2<-tidy(t2, digits=1)

m2 %>%
  select(-c(estimate,statistic,parameter))%>%
  rename(
    AVG_deception_video=estimate1,
    AVG_deception_text=estimate2
  )%>%
  kableExtra::kbl(caption="T test: Deception level of video vs text")%>%
  kableExtra::kable_styling(latex_options = "scale_down")%>% # use scale_down option to make the font
  kableExtra::kable_styling(latex_options = c("hold_position"))
```

### T test3
```{r ttest3, echo=FALSE, fig.width=10, fig.height=3}

t3<-t.test(na.omit(dat$believed_true[dat$treat_fake_video == 1]), 
       na.omit(dat$believed_true[dat$treat_skit == 1]))

m3<-tidy(t3, digits=1)

m3 %>%
  select(-c(estimate,statistic,parameter))%>%
  rename(
    AVG_deception_video=estimate1,
    AVG_deception_skit=estimate2
  )%>%
  kableExtra::kbl(caption="T test: Deception level of video vs skit")%>%
  kableExtra::kable_styling(latex_options = "scale_down")%>% # use scale_down option to make the font
  kableExtra::kable_styling(latex_options = c("hold_position"))
```

## Affect Level

### T test 1

```{r}
#video vs control
t1_a<-t.test(na.omit(dat$post_favor_Sanders[dat$treat_fake_video == 1]), 
       na.omit(dat$post_favor_Sanders[dat$treat_control == 1]))

m1_a<-tidy(t1_a,digits=1)

m1_a%>%
  select(-c(estimate,statistic,parameter))%>%
  rename(
    AVG_affect_video=estimate1,
    AVG_affect_control=estimate2
  )%>%
  kableExtra::kbl(caption = "T test: Affect level of video vs control")%>%
  kableExtra::kable_styling(latex_options = "scale_down")%>%# use scale_down option to make the font
  kableExtra::kable_styling(latex_options = c("hold_position"))
```


### T test2
```{r}
#video vs text
t2_a<-t.test(na.omit(dat$post_favor_Sanders[dat$treat_fake_video == 1]), 
       na.omit(dat$post_favor_Sanders[dat$treat_fake_text == 1]))

m2_a<-tidy(t2_a,digits=1)

m2_a%>%
  select(-c(estimate,statistic,parameter))%>%
  rename(
    AVG_affect_video=estimate1,
    AVG_affect_text=estimate2
  )%>%
  kableExtra::kbl(caption = "T test: Affect level of video vs text")%>%
  kableExtra::kable_styling(latex_options = "scale_down")%>%# use scale_down option to make the font
  kableExtra::kable_styling(latex_options = c("hold_position"))
```
### T test3
```{r}
#video vs audio
t3_a<-t.test(na.omit(dat$post_favor_Sanders[dat$treat_fake_video == 1]), 
       na.omit(dat$post_favor_Sanders[dat$treat_fake_audio == 1]))

m3_a<-tidy(t3_a,digits=1)

m3_a%>%
  select(-c(estimate,statistic,parameter))%>%
  rename(
    AVG_affect_video=estimate1,
    AVG_affect_audio=estimate2
  )%>%
  kableExtra::kbl(caption = "T test: Affect level of video vs audio")%>%
  kableExtra::kable_styling(latex_options = "scale_down")%>%# use scale_down option to make the font
  kableExtra::kable_styling(latex_options = c("hold_position"))
```
### T test 4
```{r}
#video vs skit
t4_a<-t.test(na.omit(dat$post_favor_Sanders[dat$treat_fake_video == 1]), 
       na.omit(dat$post_favor_Sanders[dat$treat_skit == 1]))

m4_a<-tidy(t4_a,digits=1)

m4_a%>%
  select(-c(estimate,statistic,parameter))%>%
  rename(
    AVG_affect_video=estimate1,
    AVG_affect_skit=estimate2
  )%>%
  kableExtra::kbl(caption = "T test: Affect level of video vs skit")%>%
  kableExtra::kable_styling(latex_options = "scale_down")%>%# use scale_down option to make the font
  kableExtra::kable_styling(latex_options = c("hold_position"))
```





## Feature selection 



```{r fs, echo=FALSE, fig.width=10, fig.height=10 }
library(randomForest)
library(plyr)

# deal with missing value
FS<- dat%>%
select(-c(PID_presurvey,comments,PID_leaners,script,quality_pretreat_duration_tooquick,quality_pretreat_duration_tooslow,ambivalent_sexism_1,ambivalent_sexism_2,ambivalent_sexism_3,ambivalent_sexism_4,ambivalent_sexism_5,believed1_true,believed_attackad_true,believed1_attackad_true,believed_offensive,believed_offensive1,believed_funny,believed_funny1,believed_informative,believed_informative1,exp_1_prompt_control,exp_1_prompt_info,exp_2_prompt_control,exp_2_prompt_accuracy,post_favor_Klobuchar,post_favor_Warren,post_favor_Biden,post_favor_Bloomberg,,exp_2_pct_correct,exp_2_pct_false_fake,exp_2_pct_false_real,post_media_trust1,post_media_trust2,post_media_trust3,post_media_trust,post_dig_lit_1,post_dig_lit_2,post_dig_lit_3,post_dig_lit_4,post_dig_lit_5,post_dig_lit_6,post_dig_lit_7,PID_main,crt1,crt2,crt3,agegroup,treat_control,treat_attackad,treat_fake_text,treat_fake_video,treat_fake_audio,treat_skit,polknow_speaker,polknow_boris,polknow_house,polknow_senate,polknow_veto,polknow_warren,polknow_medicare,quality_demographic_mismatch,quality_failed_backend_attncheck,duration_secs,age,meta_screenres,StartDate,EndDate,meta_resolution,exp_2_hifake,exp_2_lofake,exp_2_nofake))%>%
na.omit()
## feature selection 
set.seed(123)
FS_tree<-randomForest(post_favor_Sanders~., data=FS, importance=TRUE,proximity=TRUE) ## variable importance

FS_tree<-as.data.frame(FS_tree$importanceSD) # transform to dataframe

FS_tree<- FS_tree[order(-FS_tree[,]),,drop=FALSE] # sort importance by descending order

FS_tree<- cbind(Variable_name = rownames(FS_tree), FS_tree)
rownames(FS_tree) <- 1:nrow(FS_tree)
FS_tree<- as.data.frame(FS_tree)
```

```{r tree, echo=FALSE, warning=FALSE, fig.width=8, fig.height=7}

FS_tree%>%
  mutate(name = fct_reorder(FS_tree$Variable_name,FS_tree$`FS_tree$importanceSD`))%>%
  ggplot(aes(x=FS_tree$Variable_name, y=FS_tree$`FS_tree$importanceSD`)) +
  geom_segment( aes(x=FS_tree$Variable_name,xend=FS_tree$Variable_name, y=0, yend=FS_tree$`FS_tree$importanceSD`), color="grey") +
  geom_point( color="orange", size=4) +
  theme_light() +
  coord_flip()+
  theme(
    panel.grid.major.x = element_blank(),
    panel.border = element_blank(),
    axis.ticks.x = element_blank()
  ) +
  xlab("") +
  ylab("Importance value")+
  ggtitle("Variable importance plot")


```

## regression model 

```{r regression, echo=FALSE, warning=FALSE, fig.width=8, fig.height=7}

## transfer data into dummy
library(fastDummies)

Dummy_data<- fastDummies::dummy_cols(FS, remove_first_dummy = TRUE, remove_selected_columns = TRUE)%>%
  select(-c(2:4))#  change categorical var to factors 

##create model
model <- lm(post_favor_Sanders ~., data =Dummy_data )
summary(model)
```

\begin{equation}
Pr(\theta | y) = \frac{Pr(y | \theta) Pr(\theta)}{Pr(y)}  (\#eq:bayes)
\end{equation}

Equation \@ref(eq:bayes) seems useful, eh?

Here's a dumb example of how to use some references: In paper we run our analysis in `R` [@citeR]. We also use the `tidyverse` which was written by @thereferencecanbewhatever If we were interested in baseball data then @citeLahman could be useful. 

We can use maths by including latex between dollar signs, for instance $\theta$.


# Results

# Discussion

## First discussion point

## Second discussion point

## Third discussion point

## Weaknesses and next steps



\newpage

\appendix

# Appendix

## missing value
```{r missing, fig.cap="Missing value Visualization ", echo=FALSE, fig.width=10, fig.height=10}
library("VIM")
aggr(dat,prop=FALSE,numbers=TRUE)

```



\newpage


# References


